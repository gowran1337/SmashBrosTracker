@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center header">
    <h1>Smash Bros Tracker</h1>
    <p>Track your wins and kebabs in Super Smash Bros Melee!</p>
</div>

<div class="container">
    <!-- Player Forms -->
    <div class="player-forms">
        <form method="post" asp-page-handler="StartSession" id="sessionForm" class="combined-form">
            <div class="player-form-section">
                <h3>Player 1</h3>
                <label for="Player1NameInput">Player Name</label>
                <select id="Player1NameInput" name="Player1Id" asp-for="Player1Id" required>
                    <option value="" selected disabled>Choose player</option>
                    @foreach (var Player in Model.Players)
                    {
                        <option value="@Player.Id">@Player.Name</option>
                    }
                </select>

                <label for="P1Select">Character</label>
                <select id="P1Select" name="Player1CharacterId" asp-for="Player1CharacterId" required>
                    <option value="" selected disabled>Choose character</option>
                    @foreach (var Character in Model.Characters)
                    {
                        <option value="@Character.Id">@Character.Name</option>
                    }
                </select>
            </div>

            <div class="player-form-section">
                <h3>Player 2</h3>
                <label for="Player2NameInput">Player Name</label>
                <select id="Player2NameInput" name="Player2Id" asp-for="Player2Id" required>
                    <option value="" selected disabled>Choose player</option>
                    @foreach (var Player in Model.Players)
                    {
                        <option value="@Player.Id">@Player.Name</option>
                    }
                </select>

                <label for="P2Select">Character</label>
                <select id="P2Select" name="Player2CharacterId" asp-for="Player2CharacterId" required>
                    <option value="" selected disabled>Choose character</option>
                    @foreach (var Character in Model.Characters)
                    {
                        <option value="@Character.Id">@Character.Name</option>
                    }
                </select>
            </div>

            <div class="start-session-container">
                <button type="submit" class="start-session-button">Start Session</button>
            </div>
        </form>
    </div>

    <!-- Character Display Section -->
    <div class="character-display">
        <div class="character-images">
            <div class="character-image-container">
                <img id="P1CharacterImage" class="character-image" src="" alt="Player 1 Character" style="display: none;">
                <img id="VSImage" class="vs-image" src="/images/vs.png" alt="VS" style="display: none;">
                <img id="P2CharacterImage" class="character-image" src="" alt="Player 2 Character" style="display: none;">
                <img id="chooseCharacterImage" src="/images/choose.png" alt="Choose Your Character" class="choose-character-image" />
            </div>
        </div>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard-container">
        <div class="leaderboard">
            <h2>Leaderboards</h2>
            <table>
                <tr>
                    <th>Player</th>
                    <th>Stars</th>
                    <th>Kebabs Won</th> 
                    <th> </th>
                </tr>
                @foreach (var Player in Model.Players)
                {
                    <tr>
                        <td>@Player.Name</td>
                        <td>@Player.TotalStars</td>
                        <td>@Player.KebabsWon</td>
                        <td>
                            <form method="post" asp-page-handler="DeletePlayer" asp-route-id="@Player.Id">
                                <input type="submit" value="Delete" class="delete-button">
                            </form>
                        </td>
                    </tr>
                }
            </table>
        </div>

        <!-- Add Player Section -->
        <div class="add-player">
            <form method="post" asp-page-handler="AddPlayerMethod" id="add-player-form">
                <h3>Add Player</h3>
                <label for="CreatePlayer">Player Name</label>
                <input type="text" id="CreatePlayer" name="SelectedPlayerName" asp-for="SelectedPlayerName" required>
                <span id="name-error" class="text-danger" style="display: none;">A player with this name already exists.</span>
                <button type="submit" class="add-player-button">Add Player</button>
            </form>
        </div>
    </div>
</div>

<h2>Sessions</h2>

<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>Player</th>
            <th>Character</th>
            <th>Stars Earned</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var session in Model.Sessions)
        {
            foreach (var player in session.SessionPlayers)
            {
                <tr>
                    <td>@session.Date.ToString("yyyy-MM-dd HH:mm")</td>
                    <td>@player.Player.Name</td>
                    <td>@player.Character.Name</td>
                    <td>@player.StarsEarned</td>
                </tr>
            }
        }
    </tbody>
</table>

<script>
    console.log('Script starting...');
    
    document.addEventListener("DOMContentLoaded", function () {
        console.log('DOM Content Loaded');
        
        const characterImages = {
            1: "/images/characters/fox.png",
            2: "/images/characters/falco.png",
            3: "/images/characters/marth.png",
            4: "/images/characters/sheik.png",
            5: "/images/characters/captainfalcon.png",
            6: "/images/characters/peach.png",
            7: "/images/characters/jigglypuff.png",
            8: "/images/characters/luigi.png"
        };

        console.log('Character images object:', characterImages);

        function updateCharacterImages() {
            console.log('updateCharacterImages function called');
            
            const p1Select = document.getElementById("P1Select");
            const p2Select = document.getElementById("P2Select");
            const p1Img = document.getElementById("P1CharacterImage");
            const p2Img = document.getElementById("P2CharacterImage");
            const vsImg = document.getElementById("VSImage");
            const chooseCharacterImage = document.getElementById("chooseCharacterImage");

            console.log('Found elements:', {
                p1Select: p1Select,
                p2Select: p2Select,
                p1Img: p1Img,
                p2Img: p2Img,
                vsImg: vsImg,
                chooseCharacterImage: chooseCharacterImage
            });

            const p1CharacterId = p1Select.value;
            const p2CharacterId = p2Select.value;

            console.log('Selected character IDs:', {
                p1: p1CharacterId,
                p2: p2CharacterId
            });

            if (characterImages[p1CharacterId] && characterImages[p2CharacterId]) {
                console.log('Both characters selected, showing images');
                chooseCharacterImage.style.display = "none";
                p1Img.src = characterImages[p1CharacterId];
                p2Img.src = characterImages[p2CharacterId];
                p1Img.style.display = "block";
                p2Img.style.display = "block";
                vsImg.style.display = "block";
            } else {
                console.log('One or both characters not selected, showing choose image');
                p1Img.style.display = "none";
                p2Img.style.display = "none";
                vsImg.style.display = "none";
                chooseCharacterImage.style.display = "block";
            }
        }

        const p1Select = document.getElementById("P1Select");
        const p2Select = document.getElementById("P2Select");

        console.log('Adding event listeners to:', {
            p1Select: p1Select,
            p2Select: p2Select
        });

        p1Select.addEventListener("change", function() {
            console.log('P1 selection changed');
            updateCharacterImages();
        });

        p2Select.addEventListener("change", function() {
            console.log('P2 selection changed');
            updateCharacterImages();
        });

        console.log('Event listeners added');
    });
</script>

