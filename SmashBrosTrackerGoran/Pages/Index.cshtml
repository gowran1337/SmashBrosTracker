@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center header">
    <h1>Smash Bros Tracker</h1>
    <p>Track your wins and kebabs in Super Smash Bros Melee!</p>
</div>

<div class="container">
    <!-- Combined Player Form Section -->
    <div class="player-forms">
        <form orm method="post" asp-page-handler="StartSession" id="sessionForm" class="combined-form">
            <div class="player-form-section">
                <h3>Player 1</h3>
                <label for="Player1NameInput">Player Name</label>
                <select id="Player1NameInput" name="Player1Id" asp-for="Player1Id" required>
                    <option value="" selected disabled>Choose player</option>
                    @foreach (var Player in Model.Players)
                    {
                        <option value="@Player.Id">@Player.Name</option>
                    }
                </select>

                <label for="P1Select">Character</label>
                <select id="P1Select" name="Player1CharacterId" asp-for="Player1CharacterId" required>
                    <option value="" selected disabled>Choose character</option>
                    @foreach (var Character in Model.Characters)
                    {
                        <option value="@Character.Id">@Character.Name</option>
                    }
                </select>
            </div>

            <div class="player-form-section">
                <h3>Player 2</h3>
                <label for="Player2NameInput">Player Name</label>
                <select id="Player2NameInput" name="Player2Id" asp-for="Player2Id" required>
                    <option value="" selected disabled>Choose player</option>
                    @foreach (var Player in Model.Players)
                    {
                        <option value="@Player.Id">@Player.Name</option>
                    }
                </select>

                <label for="P2Select">Character</label>
                <select id="P2Select" name="Player2CharacterId" asp-for="Player2CharacterId" required>
                    <option value="" selected disabled>Choose character</option>
                    @foreach (var Character in Model.Characters)
                    {
                        <option value="@Character.Id">@Character.Name</option>
                    }
                </select>
            </div>

            <div class="start-session-container">
                <button type="submit" class="start-session-button">Start Session</button>
            </div>
        </form>
    </div>

    <!-- Rest of your code (leaderboard, add player section) remains the same -->
</div>

    <!-- Leaderboard Section -->
    <div class="leaderboard-container">
        <div class="leaderboard">
            <h2>Leaderboards</h2>
            <table>
                <tr>
                    <th>Player</th>
                    <th>Stars</th>
                    <th>Kebabs Won</th> 
                    <th> </th>
                </tr>
                @foreach (var Player in Model.Players)
                {
                    <tr>
                        <td>@Player.Name</td>
                        <td>@Player.TotalStars</td>
                        <td>@Player.KebabsWon</td>
                        <td>
                            <form method="post" asp-page-handler="DeletePlayer" asp-route-id="@Player.Id">
                                <input type="submit" value="Delete" class="delete-button">
                            </form>
                        </td>
                    </tr>
                }
            </table>
        </div>

        <!-- Add Player Section -->
        <div class="add-player">
            <form method="post" asp-page-handler="AddPlayerMethod" id="add-player-form">
                <h3>Add Player</h3>
                <label for="CreatePlayer">Player Name</label>
                <input type="text" id="CreatePlayer" name="SelectedPlayerName" asp-for="SelectedPlayerName" required>
                <span id="name-error" class="text-danger" style="display: none;">A player with this name already exists.</span>
                <button type="submit">Add Player</button>
            </form>
        </div>
    </div>
</div>




<div class="character-image-container">
    <img id="P1CharacterImage" class="character-image" src="" alt="Player 1 Character">
    <img id="VSImage" class="vs-image" src="/images/vs.png" alt="VS" style="display: none;">
    <img id="P2CharacterImage" class="character-image" src="" alt="Player 2 Character">
    <img id="chooseCharacterImage" src="/images/choose.png" alt="Choose Your Character" class="choose-character-image" />
</div><


<script>
    

    document.addEventListener("DOMContentLoaded", function () {
        const player1Select = document.getElementById("Player1NameInput");
        const player2Select = document.getElementById("Player2NameInput");

        if (player1Select && player2Select) {
            // Function to disable the selected option in the other dropdown
            function updateDropdowns() {
                const player1SelectedId = player1Select.value;
                const player2SelectedId = player2Select.value;

                // Enable all options in both dropdowns first
                Array.from(player1Select.options).forEach(option => option.disabled = false);
                Array.from(player2Select.options).forEach(option => option.disabled = false);

                // Disable the selected option in the other dropdown
                if (player1SelectedId) {
                    const player1Option = player2Select.querySelector(`option[value="${player1SelectedId}"]`);
                    if (player1Option) player1Option.disabled = true;
                }

                if (player2SelectedId) {
                    const player2Option = player1Select.querySelector(`option[value="${player2SelectedId}"]`);
                    if (player2Option) player2Option.disabled = true;
                }
            }

            // Add event listeners to both dropdowns
            player1Select.addEventListener("change", updateDropdowns);
            player2Select.addEventListener("change", updateDropdowns);

            // Initialize the dropdowns on page load
            updateDropdowns();
        }
    });
</script><!--Js for different players in session-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const addPlayerForm = document.getElementById("add-player-form");
        const playerNameInput = document.getElementById("CreatePlayer");
        const nameError = document.getElementById("name-error");

        if (addPlayerForm) {
            addPlayerForm.addEventListener("submit", function (event) {
                event.preventDefault(); // Prevent default form submission

                const playerName = playerNameInput.value.trim();

                // Get the list of existing player names
                const existingPlayerNames = Array.from(document.querySelectorAll("#Player1NameInput option, #Player2NameInput option"))
                    .map(option => option.textContent.trim());

                // Check if the player name already exists
                if (existingPlayerNames.includes(playerName)) {
                    nameError.style.display = "block"; // Show the error message
                } else {
                    nameError.style.display = "none"; // Hide the error message
                    addPlayerForm.submit(); // Submit the form if the name is unique
                }
            });
        }
    });
</script><!--JS for creating unique player names-->





<script>
              document.addEventListener("DOMContentLoaded", function () {
        const characterImages = {
            1: "/images/characters/fox.png",
            2: "/images/characters/falco.png",
            3: "/images/characters/marth.png",
            4: "/images/characters/sheik.png",
            5: "/images/characters/captainfalcon.png",
            6: "/images/characters/peach.png",
            7: "/images/characters/jigglypuff.png",
            8: "/images/characters/luigi.png"
        };

        function updateCharacterImages() {
            const p1Select = document.getElementById("P1Select");
            const p2Select = document.getElementById("P2Select");
            const p1Img = document.getElementById("P1CharacterImage");
            const p2Img = document.getElementById("P2CharacterImage");
            const vsImg = document.getElementById("VSImage");
            const chooseCharacterImage = document.getElementById("chooseCharacterImage");

            const p1CharacterId = p1Select.value;
            const p2CharacterId = p2Select.value;

            if (characterImages[p1CharacterId] && characterImages[p2CharacterId]) {
                // Hide the "Choose Your Character" image when both players have selected characters
                chooseCharacterImage.style.display = "none";

                // Show character images for both players
                p1Img.src = characterImages[p1CharacterId];
                p2Img.src = characterImages[p2CharacterId];

                p1Img.style.display = "block";
                p2Img.style.display = "block";

                // Show the "VS" image
                vsImg.style.display = "block";
            } else {
                // If either player has not selected a character, hide all images
                p1Img.style.display = "none";
                p2Img.style.display = "none";
                vsImg.style.display = "none";

                // Show the "Choose Your Character" image when either player hasn't selected
                chooseCharacterImage.style.display = "block";
            }
        }

        // Listen for changes in character selections
        document.getElementById("P1Select").addEventListener("change", updateCharacterImages);
        document.getElementById("P2Select").addEventListener("change", updateCharacterImages);
    });

</script> <!--JS for showing images based on selected character-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const startSessionButton = document.querySelector(".start-session-button");
        startSessionButton.addEventListener("click", function () {
            document.getElementById("Player1Id").value = document.getElementById("Player1NameInput").value;
            document.getElementById("Player2Id").value = document.getElementById("Player2NameInput").value;
            document.getElementById("Player1CharacterId").value = document.getElementById("P1Select").value;
            document.getElementById("Player2CharacterId").value = document.getElementById("P2Select").value;
        });
    });
</script><!--jS FOR sending ints about character and player name choice-->